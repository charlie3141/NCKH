// UI update and interaction functions
function loadPhraseSuggestions() {
    const phrasePills = document.getElementById('phrasePills');
    phrasePills.innerHTML = '';
    
    utils.commonPhrases.forEach(phrase => {
        const pill = document.createElement('button');
        pill.className = 'phrase-pill';
        pill.textContent = phrase.length > 30 ? phrase.substring(0, 27) + '...' : phrase;
        pill.onclick = () => {
            document.getElementById('translationInput').value = phrase;
            window.translation.translatePhrase(phrase);
            utils.log('PHRASE', `Selected phrase: "${phrase}"`);
        };
        pill.title = phrase;
        phrasePills.appendChild(pill);
    });
}

function showAutoSuggestions() {
    const sentenceWords = window.wordConstruction?.sentenceWords || [];
    if (sentenceWords.length === 0) {
        document.getElementById('autoSuggestionsPanel').style.display = 'none';
        return;
    }
    
    const panel = document.getElementById('autoSuggestionsPanel');
    const grid = document.getElementById('autoSuggestionsGrid');
    
    // Create suggestions based on current sentence
    const currentSentence = window.wordConstruction?.convertedFullSentence || '';
    const suggestions = [];
    
    if (currentSentence.includes('xin ch√†o') || currentSentence.includes('ch√†o')) {
        suggestions.push({
            text: 'Xin ch√†o, r·∫•t vui ƒë∆∞·ª£c g·∫∑p b·∫°n',
            type: 'greeting'
        });
    }
    
    if (currentSentence.includes('c·∫£m ∆°n')) {
        suggestions.push({
            text: 'Kh√¥ng c√≥ g√¨, r·∫•t vui ƒë∆∞·ª£c gi√∫p ƒë·ª°',
            type: 'response'
        });
    }
    
    if (currentSentence.includes('t√™n') || currentSentence.includes('b·∫°n t√™n')) {
        suggestions.push({
            text: 'T√¥i l√† tr·ª£ l√Ω ng√¥n ng·ªØ, r·∫•t vui ƒë∆∞·ª£c gi√∫p b·∫°n',
            type: 'introduction'
        });
    }
    
    // Add some default suggestions if none matched
    if (suggestions.length === 0) {
        suggestions.push(
            { text: 'B·∫°n c√≥ th·ªÉ n√≥i ch·∫≠m h∆°n ƒë∆∞·ª£c kh√¥ng?', type: 'request' },
            { text: 'T√¥i kh√¥ng hi·ªÉu, b·∫°n c√≥ th·ªÉ gi·∫£i th√≠ch kh√¥ng?', type: 'clarification' },
            { text: 'R·∫•t vui ƒë∆∞·ª£c tr√≤ chuy·ªán v·ªõi b·∫°n', type: 'conversation' }
        );
    }
    
    grid.innerHTML = suggestions.map(suggestion => `
        <div class="auto-suggestion-item">
            <div class="auto-suggestion-text">${suggestion.text}</div>
            <div class="auto-suggestion-actions">
                <button class="auto-suggestion-btn speak" onclick="window.speech.speakText('${suggestion.text}', 'vi-VN')">üîä ƒê·ªçc</button>
                <button class="auto-suggestion-btn use" onclick="useSuggestion('${suggestion.text}')">üìù D√πng</button>
                <button class="auto-suggestion-btn translate" onclick="translateSuggestion('${suggestion.text}')">üåê D·ªãch</button>
            </div>
        </div>
    `).join('');
    
    panel.style.display = 'block';
}

function useSuggestion(text) {
    document.getElementById('translationInput').value = text;
    window.translation.translateSentence();
    utils.log('SUGGESTION', `Using suggestion: "${text}"`);
}

function translateSuggestion(text) {
    document.getElementById('translationInput').value = text;
    window.translation.translateSentence();
    utils.log('SUGGESTION', `Translating suggestion: "${text}"`);
}

function updateUI() {
    if (window.wordConstruction) {
        window.wordConstruction.updateWordDisplays();
        window.wordConstruction.updateSentenceDisplay();
    }
    
    const speakVnBtn = document.getElementById('speakVnBtn');
    const speakTransBtn = document.getElementById('speakTransBtn');
    const stopSpeechBtn = document.getElementById('stopSpeechBtn');
    
    const convertedFullSentence = window.wordConstruction?.convertedFullSentence || '';
    const translationOutput = document.getElementById('translationOutput').textContent;
    
    speakVnBtn.disabled = !convertedFullSentence || window.speech?.isSpeaking;
    speakTransBtn.disabled = !translationOutput || translationOutput.includes('ƒêang ch·ªù d·ªãch') || window.speech?.isSpeaking;
    stopSpeechBtn.disabled = !window.speech?.isSpeaking;
    
    if (window.speech?.isSpeaking) {
        speakVnBtn.classList.add('speaking');
    } else {
        speakVnBtn.classList.remove('speaking');
    }
    
    const langNames = {
        'vi-VN': 'Ti·∫øng Vi·ªát',
        'en-GB': 'Ti·∫øng Anh',
        'ja-JP': 'Ti·∫øng Nh·∫≠t',
        'ko-KR': 'Ti·∫øng H√†n',
        'zh-CN': 'Ti·∫øng Trung'
    };
    const genderNames = {
        'male': 'Nam',
        'female': 'N·ªØ'
    };
    const ttsMode = window.speech?.useGeminiTTS ? 'Gemini AI' : 'Web Speech';
    const currentVoice = window.speech?.currentVoice || { lang: 'vi-VN', gender: 'male' };
    
    document.getElementById('currentVoiceDisplay').textContent = 
        `Hi·ªán t·∫°i: ${langNames[currentVoice.lang] || currentVoice.lang} ${genderNames[currentVoice.gender] || currentVoice.gender} (${ttsMode})`;
    
    document.getElementById('useGeminiTTS').classList.toggle('active', window.speech?.useGeminiTTS);
    document.getElementById('useWebSpeech').classList.toggle('active', !window.speech?.useGeminiTTS);
}

// Export c√°c h√†m
window.ui = {
    loadPhraseSuggestions,
    showAutoSuggestions,
    useSuggestion,
    translateSuggestion,
    updateUI
};
