<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·ª®ng d·ª•ng v√† c·∫£i ti·∫øn "C√¥ng ngh·ªá d·ªãch th·ªß ng·ªØ" v√†o ƒë·ªùi s·ªëng - Phi√™n b·∫£n t·ªëi ∆∞u v·ªõi Calibration</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="fast-mode" id="fastModeIndicator">üöÄ Ch·∫ø ƒë·ªô t·ªëc ƒë·ªô cao: B·∫¨T</div>
    <div class="container">
        <header>
            <h1>·ª®ng d·ª•ng v√† c·∫£i ti·∫øn "C√¥ng ngh·ªá d·ªãch th·ªß ng·ªØ" v√†o ƒë·ªùi s·ªëng - Phi√™n b·∫£n t·ªëi ∆∞u v·ªõi Calibration</h1>
            <div>Gi√°m s√°t th·ªùi gian th·ª±c t·ª´ C∆° s·ªü d·ªØ li·ªáu Firebase</div>
            <div class="firebase-status" id="firebaseStatus">
                ƒêang k·∫øt n·ªëi v·ªõi Firebase...
            </div>
            <div class="performance-info" id="performanceInfo">
                ƒê·ªô tr·ªÖ: <span id="latency">--</span>ms | FPS: <span id="fps">--</span> | Polling: <span id="pollingRate">--</span>ms
            </div>
        </header>

        <div class="dashboard">
            <!-- Card X√¢y d·ª±ng C√¢u -->
            <div class="card">
                <h3>X√¢y d·ª±ng C√¢u</h3>
                <div style="text-align: center; padding: 20px; margin-bottom: 20px;">
                    <div class="sensor-label">T·ª™ HI·ªÜN T·∫†I (M√£ h√≥a)</div>
                    <div class="current-word-display" id="displayBuffer">---</div>
                    <div class="sensor-label">T·ª™ HI·ªÜN T·∫†I (Ti·∫øng Vi·ªát)</div>
                    <div class="conversion-display" id="convertedCurrentWord">---</div>
                    
                    <div style="margin: 15px 0; color: #666;">
                        <div><strong>S·ª≠ d·ª•ng '_' ƒë·ªÉ th√™m t·ª´ v√†o c√¢u</strong></div>
                        <div><strong>S·ª≠ d·ª•ng 'COMMIT' ƒë·ªÉ ho√†n th√†nh c√¢u</strong></div>
                    </div>
                    
                    <div class="sensor-label">C√ÇU ƒê·∫¶Y ƒê·ª¶ (M√£ h√≥a)</div>
                    <div class="sentence-display" id="sentenceDisplay">---</div>
                    <div class="sensor-label">C√ÇU ƒê·∫¶Y ƒê·ª¶ (Ti·∫øng Vi·ªát)</div>
                    <div class="conversion-display" id="convertedSentenceDisplay">---</div>
                    
                    <!-- Chuy·ªÉn ƒë·ªïi TTS -->
                    <div class="tts-toggle">
                        <button class="tts-toggle-btn active" id="useGeminiTTS">üéØ Gi·ªçng AI Gemini</button>
                        <button class="tts-toggle-btn" id="useWebSpeech">üîä Web Speech</button>
                    </div>
                    
                    <!-- B·∫£ng ƒë·ªÅ xu·∫•t t·ª± ƒë·ªông -->
                    <div class="auto-suggestions-panel" id="autoSuggestionsPanel" style="display: none;">
                        <div class="auto-suggestions-title">
                            <span>üí° ƒê·ªÄ XU·∫§T D·ª∞A TR√äN C√ÇU C·ª¶A B·∫†N</span>
                        </div>
                        <div class="auto-suggestions-grid" id="autoSuggestionsGrid">
                            <!-- ƒê·ªÅ xu·∫•t t·ª± ƒë·ªông s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
                        </div>
                    </div>
                    
                    <!-- ƒê·ªÅ xu·∫•t c·ª•m t·ª´ -->
                    <div class="phrase-suggestions">
                        <h4>üìù ƒê·ªÄ XU·∫§T C·ª§M T·ª™ TH√îNG D·ª§NG</h4>
                        <div class="phrase-pills" id="phrasePills">
                            <!-- C√°c n√∫t c·ª•m t·ª´ s·∫Ω ƒë∆∞·ª£c th√™m b·ªüi JavaScript -->
                        </div>
                        
                        <!-- ƒê·ªÅ xu·∫•t ƒë·ªông -->
                        <div class="dynamic-suggestions" id="dynamicSuggestions">
                            <!-- ƒê·ªÅ xu·∫•t ƒë·ªông s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y -->
                        </div>
                    </div>
                    
                    <!-- T√πy ch·ªçn gi·ªçng n√≥i -->
                    <div class="voice-options">
                        <div class="voice-btn male active" data-gender="male" data-lang="vi-VN">
                            üë® Nam Ti·∫øng Vi·ªát
                        </div>
                        <div class="voice-btn female" data-gender="female" data-lang="vi-VN">
                            üë© N·ªØ Ti·∫øng Vi·ªát
                        </div>
                        <div class="voice-btn male" data-gender="male" data-lang="en-GB">
                            üë® Nam Ti·∫øng Anh
                        </div>
                        <div class="voice-btn female" data-gender="female" data-lang="en-GB">
                            üë© N·ªØ Ti·∫øng Anh
                        </div>
                    </div>
                    
                    <div class="language-voice-display" id="currentVoiceDisplay">
                        Hi·ªán t·∫°i: Nam Ti·∫øng Vi·ªát (Gemini AI)
                    </div>
                    
                    <div class="ai-speech-status" id="aiSpeechStatus" style="display: none;">
                        <span class="ai-loading">‚è≥</span> ƒêang t·∫£i gi·ªçng AI...
                    </div>
                    
                    <!-- ƒêi·ªÅu khi·ªÉn gi·ªçng n√≥i -->
                    <div class="speech-controls">
                        <button class="speech-btn" id="speakVnBtn">
                            üîä ƒê·ªçc Ti·∫øng Vi·ªát
                        </button>
                        <button class="speech-btn blue" id="speakTransBtn">
                            üîà ƒê·ªçc B·∫£n d·ªãch
                        </button>
                        <button class="speech-btn red" id="stopSpeechBtn">
                            ‚èπ D·ª´ng ƒë·ªçc
                        </button>
                    </div>
                    
                    <div class="audio-visualizer" id="audioVisualizer">
                        <!-- Thanh √¢m thanh s·∫Ω ƒë∆∞·ª£c th√™m ·ªü ƒë√¢y -->
                    </div>
                    
                    <div class="word-list" id="wordList">Ch∆∞a c√≥ t·ª´ n√†o</div>
                    <div class="word-count">S·ªë t·ª´ trong c√¢u: <span id="wordCount">0</span>/10</div>
                    
                    <div style="display: flex; justify-content: space-around; margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <div>
                            <div class="sensor-label">KHE 1</div>
                            <div class="sensor-value" id="slot1" style="font-size: 1.2rem;">---</div>
                        </div>
                        <div>
                            <div class="sensor-label">KHE 2</div>
                            <div class="sensor-value" id="slot2" style="font-size: 1.2rem;">---</div>
                        </div>
                    </div>
                    
                    <div class="controls">
                        <button class="red" id="clearCurrentWordBtn">X√≥a t·ª´ hi·ªán t·∫°i</button>
                        <button id="backspaceBtn">X√≥a k√Ω t·ª±</button>
                        <button class="green" id="addWordBtn">Th√™m t·ª´ (_)</button>
                        <button class="blue" id="commitSentenceBtn">Ho√†n th√†nh c√¢u</button>
                        <button class="red" id="resetSentenceBtn">ƒê·∫∑t l·∫°i t·∫•t c·∫£</button>
                    </div>
                </div>
            </div>

            <!-- Card Calibration -->
            <div class="card calibration-card">
                <h3>üéØ Calibration C·∫£m bi·∫øn U·ªën</h3>
                
                <div class="calibration-instructions">
                    <h4>üìã H∆∞·ªõng d·∫´n Calibration:</h4>
                    <div class="calibration-step">ƒê·∫∑t tay th·∫≥ng v√† th∆∞ gi√£n</div>
                    <div class="calibration-step">Nh·∫•n "B·∫Øt ƒë·∫ßu Calibration"</div>
                    <div class="calibration-step">L·∫ßn l∆∞·ª£t u·ªën t·ª´ng ng√≥n tay h·∫øt m·ª©c c√≥ th·ªÉ (10 gi√¢y)</div>
                    <div class="calibration-step">H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông l∆∞u gi√° tr·ªã bent threshold</div>
                    <div class="calibration-step">Sau khi ho√†n th√†nh, h·ªá th·ªëng s·∫Ω s·ª≠ d·ª•ng gi√° tr·ªã ƒë√£ calibration</div>
                </div>
                
                <div class="calibration-status" id="calibrationStatus">
                    <div class="calibration-ready">S·∫µn s√†ng ƒë·ªÉ Calibration</div>
                </div>
                
                <!-- Hi·ªÉn th·ªã qu√° tr√¨nh calibration -->
                <div id="calibrationProgress" style="display: none;">
                    <div class="calibration-countdown" id="calibrationCountdown">10</div>
                    <div style="text-align: center; margin: 10px 0; font-weight: bold; color: #4A00E0;">
                        <span id="calibrationMessage">ƒêang calibration... Vui l√≤ng u·ªën ng√≥n tay h·∫øt m·ª©c!</span>
                    </div>
                    
                    <div class="calibration-display" id="calibrationDisplay">
                        <!-- C√°c sensor s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-bar" id="calibrationProgressBar" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- Hi·ªÉn th·ªã threshold hi·ªán t·∫°i -->
                <div class="sensor-calibration" style="margin-top: 20px;">
                    <div class="sensor-label">THRESHOLD HI·ªÜN T·∫†I</div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">
                        <div>
                            <div class="sensor-name">Flex 0</div>
                            <div class="sensor-threshold" id="currentThreshold0">300</div>
                        </div>
                        <div>
                            <div class="sensor-name">Flex 1</div>
                            <div class="sensor-threshold" id="currentThreshold1">450</div>
                        </div>
                        <div>
                            <div class="sensor-name">Flex 2</div>
                            <div class="sensor-threshold" id="currentThreshold2">350</div>
                        </div>
                        <div>
                            <div class="sensor-name">Flex 3</div>
                            <div class="sensor-threshold" id="currentThreshold3">300</div>
                        </div>
                    </div>
                </div>
                
                <div class="flex-sensor-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4CAF50;"></div>
                        <div class="legend-text">Th·∫≥ng (0)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #FF9800;"></div>
                        <div class="legend-text">H∆°i u·ªën (1)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #F44336;"></div>
                        <div class="legend-text">U·ªën h·∫øt (2)</div>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="orange" id="calibrateBtn">üéØ B·∫Øt ƒë·∫ßu Calibration</button>
                    <button class="red" id="stopCalibrateBtn" style="display: none;">‚èπ D·ª´ng Calibration</button>
                    <button class="purple" id="resetCalibrationBtn">üîÑ Reset v·ªÅ M·∫∑c ƒë·ªãnh</button>
                    <button class="blue" id="loadCalibrationBtn">üíæ T·∫£i Calibration</button>
                </div>
                
                <div class="calibration-info" style="margin-top: 15px; font-size: 0.8rem; color: #666; text-align: center;">
                    <div>Threshold th·∫≥ng c·ªë ƒë·ªãnh: Flex 0-2: 150, Flex 3: 100</div>
                    <div>Threshold bent s·∫Ω ƒë∆∞·ª£c calibration t·ª± ƒë·ªông</div>
                </div>
            </div>

            <!-- Card D·ªãch thu·∫≠t -->
            <div class="card">
                <h3>D·ªãch thu·∫≠t</h3>
                <div style="margin-bottom: 20px;">
                    <div class="sensor-label">C√ÇU ƒê·∫¶Y ƒê·ª¶ (Ti·∫øng Vi·ªát - ƒê·ªÉ d·ªãch)</div>
                    <div class="text-input-container">
                        <textarea id="translationInput" placeholder="Nh·∫≠p vƒÉn b·∫£n ti·∫øng Vi·ªát ·ªü ƒë√¢y..."></textarea>
                        <div class="dynamic-suggestions" id="translationSuggestions">
                            <!-- ƒê·ªÅ xu·∫•t ƒë·ªông cho d·ªãch thu·∫≠t -->
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <div><strong>T√πy ch·ªçn d·ªãch thu·∫≠t:</strong></div>
                        <div style="display: flex; gap: 15px; margin-top: 10px; flex-wrap: wrap;">
                            <div>
                                <div class="sensor-label">Ng√¥n ng·ªØ ƒë√≠ch</div>
                                <select id="targetLanguage" class="language-select">
                                    <option value="en-GB">Ti·∫øng Anh</option>
                                    <option value="ja-JP">Ti·∫øng Nh·∫≠t</option>
                                    <option value="ko-KR">Ti·∫øng H√†n</option>
                                    <option value="zh-CN">Ti·∫øng Trung</option>
                                </select>
                            </div>
                            <div>
                                <div class="sensor-label">Ng√¥n ng·ªØ gi·ªçng n√≥i</div>
                                <select id="voiceLanguage" class="language-select">
                                    <option value="vi-VN">Ti·∫øng Vi·ªát</option>
                                    <option value="en-GB">Ti·∫øng Anh</option>
                                    <option value="ja-JP">Ti·∫øng Nh·∫≠t</option>
                                    <option value="ko-KR">Ti·∫øng H√†n</option>
                                    <option value="zh-CN">Ti·∫øng Trung</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="sensor-label">K·∫æT QU·∫¢ D·ªäCH</div>
                <div id="translationOutput" class="conversion-display" style="min-height: 80px; margin-bottom: 15px;">
                    ƒêang ch·ªù d·ªãch...
                </div>

                <div class="controls">
                    <button class="blue" id="translateBtn">D·ªãch c√¢u</button>
                    <button class="red" id="clearTranslationBtn">X√≥a b·∫£n d·ªãch</button>
                </div>
            </div>

            <!-- Card Hi·ªÉn th·ªã C·∫£m bi·∫øn -->
            <div class="card">
                <h3>D·ªØ li·ªáu C·∫£m bi·∫øn t·ª´ Firebase</h3>
                <div class="sensor-grid">
                    <div class="sensor-item mpu">
                        <div class="sensor-label">ƒê·ªäNH H∆Ø·ªöNG MPU6050</div>
                        <div class="sensor-value" id="mpuOrientation">Kh√¥ng x√°c ƒë·ªãnh</div>
                        <div class="sensor-label">TR·∫†NG TH√ÅI L·∫ÆC</div>
                        <div class="sensor-value" id="mpuShakeState">Kh√¥ng</div>
                        <div class="sensor-label">ƒêANG L·∫ÆC?</div>
                        <div class="sensor-value" id="isShaking">KH√îNG</div>
                    </div>
                    <div class="sensor-item flex">
                        <div class="sensor-label">C·∫¢M BI·∫æN U·ªêN</div>
                        <div>
                            <div>
                                <span class="flex-box" id="flex0-box">0</span>
                                <span class="flex-box" id="flex1-box">0</span>
                                <span class="flex-box" id="flex2-box">0</span>
                                <span class="flex-box" id="flex3-box">0</span>
                            </div>
                            <div class="sensor-label" style="margin-top: 10px;">
                                Gi√° tr·ªã th√¥: <span id="rawValues">0, 0, 0, 0</span>
                            </div>
                            <div class="sensor-label">
                                Tr·∫°ng th√°i: <span id="flexFormat">0000</span> (a0,a1,a2,a3)
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="sensor-item" style="margin-top: 15px;">
                    <div class="sensor-label">TR·∫†NG TH√ÅI H·ªÜ TH·ªêNG</div>
                    <div>C·∫≠p nh·∫≠t l·∫ßn cu·ªëi: <span id="lastUpdateTime" class="last-update">Ch∆∞a bao gi·ªù</span></div>
                    <div>Th·ªùi gian x·ª≠ l√Ω: <span id="processingTime" class="last-update">0ms</span></div>
                </div>
                
                <div class="controls" style="margin-top: 15px;">
                    <button class="blue" id="refreshDataBtn">L√†m m·ªõi ngay</button>
                    <button class="green" id="autoRefreshBtn">T·ª± ƒë·ªông: B·∫¨T (300ms)</button>
                    <button class="green" id="turboBtn">üöÄ Ch·∫ø ƒë·ªô Turbo</button>
                </div>
            </div>

            <!-- Card Hi·ªÉn th·ªã Nh·∫≠t k√Ω -->
            <div class="card">
                <h3>Nh·∫≠t k√Ω H·ªá th·ªëng</h3>
                <div style="max-height: 300px; overflow-y: auto; background: #f8f9fa; border-radius: 8px; padding: 10px;">
                    <div id="logContainer">
                        <div class="log-entry">H·ªá th·ªëng ƒë√£ kh·ªüi ƒë·ªông. ƒêang ch·ªù d·ªØ li·ªáu Firebase...</div>
                    </div>
                </div>
                <div class="controls" style="margin-top: 15px;">
                    <button class="red" id="clearLogBtn">X√≥a nh·∫≠t k√Ω</button>
                    <button class="blue" id="exportLogBtn">Xu·∫•t nh·∫≠t k√Ω</button>
                </div>
            </div>
        </div>

        <div class="status-bar">
            <div>
                <span class="indicator" id="connectionStatus"></span>
                <span id="statusText">ƒêang k·∫øt n·ªëi v·ªõi Firebase...</span>
            </div>
            <div>
                <span id="lastUpdate">C·∫≠p nh·∫≠t Firebase l·∫ßn cu·ªëi: --:--:--</span>
            </div>
        </div>
    </div>

    <!-- Load JavaScript files -->
    <script src="data/vietnamese-table.js"></script>
    <script src="js/config.js"></script>
    <script src="js/calibration.js"></script>
    <script src="js/firebase.js"></script>
    <script src="js/word-processing.js"></script>
    <script src="js/translation.js"></script>
    <script src="js/speech.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
