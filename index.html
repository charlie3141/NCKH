<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vietnamese Sentence Processor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f0f2f5; color: #333; min-height: 100vh; padding: 20px; }
        
        .container { max-width: 1400px; margin: 0 auto; }
        
        header { background: linear-gradient(to right, #4A00E0, #8E2DE2); color: white; padding: 20px; border-radius: 10px 10px 0 0; text-align: center; }
        h1 { font-size: 2rem; margin-bottom: 5px; }
        
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; padding: 20px; background: white; border-radius: 0 0 10px 10px; }
        
        .card { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); border: 1px solid #eaeaea; }
        .card h3 { color: #4A00E0; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #f0f0f0; }
        
        /* Sensor Display */
        .sensor-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px; }
        .sensor-item { padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid; }
        .sensor-item.mpu { border-left-color: #2196F3; }
        .sensor-item.flex { border-left-color: #4CAF50; }
        .sensor-label { font-size: 0.8rem; color: #666; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .sensor-value { font-size: 1.5rem; font-weight: bold; color: #333; }
        
        /* Flex Boxes */
        .flex-container { display: flex; gap: 10px; margin: 10px 0; }
        .flex-box { width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-weight: bold; font-size: 1.2rem; }
        .flex-box.state-0 { background: #4CAF50; color: white; }
        .flex-box.state-1 { background: #FF9800; color: white; }
        .flex-box.state-2 { background: #F44336; color: white; }
        
        /* Word Display */
        .word-display { font-size: 1.8rem; font-weight: bold; margin: 10px 0; min-height: 60px; display: flex; align-items: center; justify-content: center; background: #E3F2FD; border-radius: 10px; padding: 15px; border: 2px solid #2196F3; }
        .vietnamese-display { font-size: 1.5rem; color: #2196F3; margin: 10px 0; min-height: 50px; display: flex; align-items: center; justify-content: center; background: #E8F5E9; border-radius: 10px; padding: 10px; border: 2px solid #4CAF50; }
        
        /* Sentence Display */
        .sentence-container { margin: 15px 0; }
        .sentence-box { background: #FFF3E0; border-radius: 10px; padding: 15px; border: 2px solid #FFB74D; min-height: 80px; margin-bottom: 10px; }
        .sentence-text { font-size: 1.5rem; font-weight: bold; color: #FF9800; }
        .vietnamese-text { font-size: 1.3rem; color: #4CAF50; }
        
        /* Controls */
        .controls { display: flex; gap: 10px; margin-top: 20px; justify-content: center; flex-wrap: wrap; }
        button { padding: 12px 24px; border: none; border-radius: 8px; background: linear-gradient(to right, #4A00E0, #8E2DE2); color: white; font-weight: bold; cursor: pointer; transition: all 0.2s; }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        button.red { background: linear-gradient(to right, #FF416C, #FF4B2B); }
        button.green { background: linear-gradient(to right, #00b09b, #96c93d); }
        button.blue { background: linear-gradient(to right, #2196F3, #21CBF3); }
        
        /* Status Bar */
        .status-bar { background: #f8f9fa; padding: 15px; border-top: 1px solid #eaeaea; display: flex; justify-content: space-between; align-items: center; margin-top: 20px; border-radius: 0 0 10px 10px; }
        .indicator { width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .indicator.online { background: #4CAF50; }
        .indicator.offline { background: #F44336; }
        
        /* Calibration */
        .calibration-status { margin: 15px 0; padding: 15px; border-radius: 10px; text-align: center; font-weight: bold; }
        .calibrating { background: #FFF3CD; border: 2px solid #FFC107; color: #856404; animation: pulse 1s infinite; }
        .calibrated { background: #D4EDDA; border: 2px solid #28A745; color: #155724; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        
        /* Word List */
        .word-list { margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 10px; border: 1px solid #eaeaea; min-height: 60px; }
        .word-item { display: inline-block; padding: 8px 15px; margin: 5px; background: #e3f2fd; border-radius: 20px; border: 1px solid #bbdefb; }
        
        /* Raw Data */
        .raw-data { font-family: monospace; background: #f8f9fa; padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 0.9rem; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Vietnamese Sentence Processor</h1>
            <div>Processing raw data from Firebase exactly like ESP32</div>
        </header>
        
        <div class="dashboard">
            <!-- Raw Sensor Data Card -->
            <div class="card">
                <h3>Raw Sensor Data from Firebase</h3>
                <div class="sensor-grid">
                    <div class="sensor-item mpu">
                        <div class="sensor-label">MPU6050</div>
                        <div class="sensor-value" id="mpuState">-1</div>
                        <div class="sensor-label">Orientation</div>
                        <div class="sensor-value" id="mpuOrientation">Unknown</div>
                        <div class="sensor-label">Shake State</div>
                        <div class="sensor-value" id="shakeState">None</div>
                    </div>
                    
                    <div class="sensor-item flex">
                        <div class="sensor-label">Flex Sensors (Raw)</div>
                        <div class="flex-container">
                            <div class="flex-box" id="flex0-box">0</div>
                            <div class="flex-box" id="flex1-box">0</div>
                            <div class="flex-box" id="flex2-box">0</div>
                            <div class="flex-box" id="flex3-box">0</div>
                        </div>
                        <div class="sensor-label">Raw Values</div>
                        <div class="sensor-value">
                            A0: <span id="rawFlex0">0</span> | 
                            A1: <span id="rawFlex1">0</span> | 
                            A2: <span id="rawFlex2">0</span> | 
                            A3: <span id="rawFlex3">0</span>
                        </div>
                        <div class="sensor-label">Calculated States</div>
                        <div class="sensor-value">
                            <span id="flexState0">0</span>
                            <span id="flexState1">0</span>
                            <span id="flexState2">0</span>
                            <span id="flexState3">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="calibration-status" id="calibrationStatus">
                    Not calibrated (using defaults)
                </div>
                
                <div class="controls">
                    <button onclick="processor.startCalibration()" class="blue">Start 10s Calibration</button>
                    <button onclick="useDefaultThresholds()" class="green">Use Defaults</button>
                </div>
            </div>
            
            <!-- Word Construction Card -->
            <div class="card">
                <h3>Word Construction</h3>
                <div class="sensor-label">CURRENT WORD BUFFER</div>
                <div class="word-display" id="displayBuffer">---</div>
                
                <div class="sensor-label">VIETNAMESE CONVERSION</div>
                <div class="vietnamese-display" id="convertedCurrentWord">---</div>
                
                <div style="display: flex; justify-content: space-around; margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                    <div>
                        <div class="sensor-label">SLOT 1</div>
                        <div class="sensor-value" style="font-size: 1.2rem;" id="slot1">---</div>
                    </div>
                    <div>
                        <div class="sensor-label">SLOT 2</div>
                        <div class="sensor-value" style="font-size: 1.2rem;" id="slot2">---</div>
                    </div>
                </div>
                
                <div style="margin: 15px 0;">
                    <div class="sensor-label">SYSTEM STATE</div>
                    <div>Stable Count: <span id="stableCount">0</span>/3</div>
                    <div>Hold Time: <span id="holdTime">0.0</span>s (need 0.8s)</div>
                </div>
                
                <div class="controls">
                    <button onclick="processor.clearWord()" class="red">Clear Current</button>
                    <button onclick="processor.backspace()">Backspace</button>
                    <button onclick="processor.addWordToSentence()" class="green">Add Word (_)</button>
                    <button onclick="processor.commitSentence()" class="blue">Commit Sentence</button>
                    <button onclick="processor.resetSentence()" class="red">Reset All</button>
                </div>
            </div>
            
            <!-- Sentence Building Card -->
            <div class="card">
                <h3>Sentence Building</h3>
                <div class="sentence-container">
                    <div class="sensor-label">FULL SENTENCE (Encoded)</div>
                    <div class="sentence-box">
                        <div class="sentence-text" id="sentenceDisplay">---</div>
                    </div>
                    
                    <div class="sensor-label">FULL SENTENCE (Vietnamese)</div>
                    <div class="sentence-box">
                        <div class="vietnamese-text" id="convertedSentenceDisplay">---</div>
                    </div>
                    
                    <div class="word-list" id="wordList">
                        No words yet
                    </div>
                    
                    <div class="sensor-label">Word Count: <span id="wordCount">0</span>/10</div>
                </div>
            </div>
            
            <!-- Debug Info Card -->
            <div class="card">
                <h3>Debug Information</h3>
                <div style="margin-bottom: 15px;">
                    <div class="sensor-label">FLEX THRESHOLDS</div>
                    <div>Straight: 150 | 
                        Bent: A0:<span id="bent0">300</span> 
                        A1:<span id="bent1">450</span> 
                        A2:<span id="bent2">350</span> 
                        A3:<span id="bent3">300</span>
                    </div>
                </div>
                
                <div>
                    <div class="sensor-label">LAST FIREBASE DATA</div>
                    <div class="raw-data" id="rawDataDisplay">
                        Waiting for data...
                    </div>
                </div>
                
                <div style="margin-top: 15px;">
                    <div class="sensor-label">MANUAL THRESHOLD SETTING</div>
                    <div style="display: flex; gap: 5px; margin-top: 10px;">
                        <input type="number" id="thresh0" value="300" placeholder="A0" style="width: 60px; padding: 5px;">
                        <input type="number" id="thresh1" value="450" placeholder="A1" style="width: 60px; padding: 5px;">
                        <input type="number" id="thresh2" value="350" placeholder="A2" style="width: 60px; padding: 5px;">
                        <input type="number" id="thresh3" value="300" placeholder="A3" style="width: 60px; padding: 5px;">
                        <button onclick="applyManualThresholds()" style="padding: 5px 10px;">Apply</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="status-bar">
            <div>
                <span class="indicator" id="connectionStatus"></span>
                <span id="statusText">Connecting to Firebase...</span>
            </div>
            <div>
                <span id="lastUpdate">Last update: --:--:--</span>
            </div>
        </div>
    </div>

    <script src="vietnamese-processor.js"></script>
    <script>
        // Additional helper functions for the HTML interface
        
        function useDefaultThresholds() {
            const thresholds = [300, 450, 350, 300];
            processor.setThresholds(thresholds);
            alert('Default thresholds applied: 300, 450, 350, 300');
        }
        
        function applyManualThresholds() {
            const thresh0 = parseInt(document.getElementById('thresh0').value) || 300;
            const thresh1 = parseInt(document.getElementById('thresh1').value) || 450;
            const thresh2 = parseInt(document.getElementById('thresh2').value) || 350;
            const thresh3 = parseInt(document.getElementById('thresh3').value) || 300;
            
            const thresholds = [thresh0, thresh1, thresh2, thresh3];
            processor.setThresholds(thresholds);
            
            // Update display
            document.getElementById('bent0').textContent = thresh0;
            document.getElementById('bent1').textContent = thresh1;
            document.getElementById('bent2').textContent = thresh2;
            document.getElementById('bent3').textContent = thresh3;
            
            alert(`Thresholds applied: ${thresh0}, ${thresh1}, ${thresh2}, ${thresh3}`);
        }
        
        // Update raw data display
        setInterval(() => {
            if (lastFirebaseData) {
                document.getElementById('rawDataDisplay').textContent = 
                    JSON.stringify(lastFirebaseData, null, 2);
            }
        }, 1000);
        
        // Update thresholds display
        setInterval(() => {
            document.getElementById('bent0').textContent = flexBentThresholds[0];
            document.getElementById('bent1').textContent = flexBentThresholds[1];
            document.getElementById('bent2').textContent = flexBentThresholds[2];
            document.getElementById('bent3').textContent = flexBentThresholds[3];
        }, 1000);
    </script>
</body>
</html>
