<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo TTS Miễn Phí - Tổng Hợp Các Công Cụ</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            line-height: 1.6;
        }
        
        .header {
            text-align: center;
            padding: 30px 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .section:hover {
            transform: translateY(-5px);
        }
        
        h2 {
            color: #3498db;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-top: 0;
        }
        
        .language-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .lang-btn {
            padding: 10px 20px;
            background: #ecf0f1;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .lang-btn:hover {
            background: #bdc3c7;
        }
        
        .lang-btn.active {
            background: #3498db;
            color: white;
        }
        
        textarea {
            width: 100%;
            height: 120px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            resize: vertical;
            margin-bottom: 15px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        button {
            padding: 12px 25px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #27ae60;
            transform: scale(1.05);
        }
        
        button.stop {
            background: #e74c3c;
        }
        
        button.stop:hover {
            background: #c0392b;
        }
        
        button.demo {
            background: #9b59b6;
        }
        
        button.demo:hover {
            background: #8e44ad;
        }
        
        .note {
            background: #fffde7;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #f1c40f;
            margin-top: 15px;
            font-size: 0.9em;
        }
        
        .warning {
            background: #ffebee;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #e74c3c;
            margin-top: 15px;
            font-size: 0.9em;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px dashed #3498db;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Demo Tổng Hợp Công Cụ TTS Miễn Phí</h1>
        <p class="subtitle">Trải nghiệm các công nghệ Text-to-Speech khác nhau trực tiếp trên trình duyệt</p>
    </div>

    <!-- Phần 1: Web Speech API (Tích hợp sẵn trong trình duyệt) -->
    <div class="section">
        <h2>1. Web Speech API (Miễn phí, tích hợp sẵn trong trình duyệt)</h2>
        <p>Đây là API chuẩn của trình duyệt, hỗ trợ nhiều ngôn ngữ, chất lượng phụ thuộc vào trình duyệt và hệ điều hành.</p>
        
        <div class="language-selector" id="webSpeechLanguages">
            <button class="lang-btn active" data-lang="vi-VN">Tiếng Việt</button>
            <button class="lang-btn" data-lang="en-US">English (US)</button>
            <button class="lang-btn" data-lang="en-GB">English (UK)</button>
            <button class="lang-btn" data-lang="fr-FR">Français</button>
            <button class="lang-btn" data-lang="es-ES">Español</button>
            <button class="lang-btn" data-lang="de-DE">Deutsch</button>
            <button class="lang-btn" data-lang="ja-JP">日本語</button>
            <button class="lang-btn" data-lang="ko-KR">한국어</button>
            <button class="lang-btn" data-lang="zh-CN">中文 (普通话)</button>
        </div>
        
        <textarea id="webSpeechText">Xin chào! Đây là bản demo Text-to-Speech sử dụng Web Speech API. Bạn có thể nhập bất kỳ văn bản nào vào đây.</textarea>
        
        <div class="controls">
            <button id="webSpeechBtn">Đọc văn bản</button>
            <button id="webSpeechStop" class="stop">Dừng đọc</button>
            <button id="webSpeechDemo" class="demo">Nghe demo đa ngôn ngữ</button>
        </div>
        
        <div class="note">
            <strong>Lưu ý:</strong> Web Speech API có sẵn trên Chrome, Edge, Safari. Trên Firefox cần bật flag. Chất lượng giọng phụ thuộc vào giọng mặc định của hệ điều hành.
        </div>
        
        <div class="result">
            <strong>Trạng thái:</strong> <span id="webSpeechStatus">Sẵn sàng</span>
            <br>
            <strong>Giọng đang dùng:</strong> <span id="webSpeechVoice">Đang tải...</span>
        </div>
    </div>

    <!-- Phần 2: Google Translate TTS (Qua iframe) -->
    <div class="section">
        <h2>2. Google Translate TTS (Gián tiếp qua iframe)</h2>
        <p>Sử dụng cơ chế của Google Translate để đọc văn bản. Chất lượng khá tốt cho nhiều ngôn ngữ.</p>
        
        <div class="language-selector" id="googleLanguages">
            <button class="lang-btn active" data-lang="vi">Tiếng Việt</button>
            <button class="lang-btn" data-lang="en">English</button>
            <button class="lang-btn" data-lang="fr">French</button>
            <button class="lang-btn" data-lang="es">Spanish</button>
            <button class="lang-btn" data-lang="de">German</button>
            <button class="lang-btn" data-lang="ja">Japanese</button>
            <button class="lang-btn" data-lang="ko">Korean</button>
            <button class="lang-btn" data-lang="zh-CN">Chinese</button>
        </div>
        
        <textarea id="googleText">Xin chào! Tôi là giọng đọc của Google Translate. Chất lượng khá ổn và hoàn toàn miễn phí.</textarea>
        
        <div class="controls">
            <button id="googleBtn">Đọc bằng Google TTS</button>
            <button id="googleStop" class="stop">Dừng đọc</button>
        </div>
        
        <div class="warning">
            <strong>Giới hạn:</strong> Phương pháp này có thể bị Google chặn nếu sử dụng quá nhiều. Chỉ dùng cho mục đích thử nghiệm.
        </div>
        
        <div class="result">
            <strong>Trạng thái:</strong> <span id="googleStatus">Sẵn sàng</span>
        </div>
        
        <!-- iframe ẩn cho Google TTS -->
        <iframe id="googleTTSFrame" style="display: none;"></iframe>
    </div>

    <!-- Phần 3: Microsoft Edge TTS (Nếu dùng trình duyệt Edge) -->
    <div class="section">
        <h2>3. Tích hợp với giọng hệ thống</h2>
        <p>Một số trình duyệt có thể sử dụng giọng hệ thống (trên Windows/macOS) nếu được cài đặt.</p>
        
        <textarea id="systemText">Đây là giọng đọc sử dụng voices có sẵn trong hệ thống của bạn. Chất lượng phụ thuộc vào giọng bạn đã cài đặt.</textarea>
        
        <div class="controls">
            <button id="systemBtn">Hiển thị giọng có sẵn</button>
            <button id="systemSpeak">Đọc bằng giọng hệ thống</button>
        </div>
        
        <div class="note">
            <strong>Mẹo:</strong> Trên Windows, vào Settings > Time & Language > Speech để cài thêm giọng chất lượng cao. Trên macOS, giọng hệ thống khá tốt.
        </div>
        
        <div class="result">
            <strong>Giọng có sẵn:</strong> <span id="systemVoices">Đang kiểm tra...</span>
        </div>
    </div>

    <!-- Phần 4: Hướng dẫn sử dụng các công cụ khác -->
    <div class="section">
        <h2>4. Các công cụ TTS miễn phí khác (Cần cài đặt/truy cập ngoài)</h2>
        
        <div class="note">
            <h3>Balabolka (Windows, Offline)</h3>
            <p><strong>Cách dùng:</strong> Tải về từ <a href="http://www.cross-plus-a.com/balabolka.htm" target="_blank">trang chủ</a>, cài đặt và sử dụng với giọng hệ thống.</p>
            
            <h3>Microsoft Azure TTS (Miễn phí có hạn mức)</h3>
            <p><strong>Cách dùng:</strong> Đăng ký tài khoản Azure free tier, nhận $200 credit, sử dụng Speech Studio.</p>
            
            <h3>Google Cloud TTS (Miễn phí có hạn mức)</h3>
            <p><strong>Cách dùng:</strong> Tạo tài khoản Google Cloud, kích hoạt Text-to-Speech API, có 1 triệu ký tự miễn phí mỗi tháng.</p>
            
            <h3>NVDA với giọng RHVoice (Miễn phí, Offline)</h3>
            <p><strong>Cách dùng:</strong> Cài NVDA và cấu hình với giọng RHVoice (hỗ trợ nhiều ngôn ngữ).</p>
        </div>
    </div>

    <div class="footer">
        <p>Demo TTS tổng hợp | Các công cụ được đề xuất: Web Speech API, Google TTS, Microsoft Edge TTS</p>
        <p>Lưu ý: Một số tính năng có thể không hoạt động trên tất cả trình duyệt. Khuyến nghị dùng Chrome/Edge để có trải nghiệm tốt nhất.</p>
    </div>

    <script>
        // ========== PHẦN 1: WEB SPEECH API ==========
        const webSpeechBtn = document.getElementById('webSpeechBtn');
        const webSpeechStop = document.getElementById('webSpeechStop');
        const webSpeechDemo = document.getElementById('webSpeechDemo');
        const webSpeechText = document.getElementById('webSpeechText');
        const webSpeechStatus = document.getElementById('webSpeechStatus');
        const webSpeechVoice = document.getElementById('webSpeechVoice');
        const webSpeechLangButtons = document.querySelectorAll('#webSpeechLanguages .lang-btn');
        
        let currentLang = 'vi-VN';
        let speechSynthesis = window.speechSynthesis;
        let currentUtterance = null;
        
        // Khởi tạo giọng nói
        function initVoices() {
            // Chờ voices được tải
            speechSynthesis.onvoiceschanged = function() {
                const voices = speechSynthesis.getVoices();
                if (voices.length > 0) {
                    // Tìm giọng phù hợp với ngôn ngữ đã chọn
                    const voice = voices.find(v => v.lang === currentLang) || voices[0];
                    webSpeechVoice.textContent = `${voice.name} (${voice.lang})`;
                }
            };
            
            // Trigger sự kiện voiceschanged nếu voices đã sẵn sàng
            if (speechSynthesis.getVoices().length > 0) {
                speechSynthesis.onvoiceschanged();
            }
        }
        
        // Thay đổi ngôn ngữ
        webSpeechLangButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                webSpeechLangButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentLang = this.getAttribute('data-lang');
                webSpeechStatus.textContent = `Đã chọn ngôn ngữ: ${currentLang}`;
                initVoices();
            });
        });
        
        // Đọc văn bản
        webSpeechBtn.addEventListener('click', function() {
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
            
            const text = webSpeechText.value.trim();
            if (!text) {
                webSpeechStatus.textContent = 'Vui lòng nhập văn bản';
                return;
            }
            
            currentUtterance = new SpeechSynthesisUtterance(text);
            currentUtterance.lang = currentLang;
            currentUtterance.rate = 1.0;
            currentUtterance.pitch = 1.0;
            currentUtterance.volume = 1.0;
            
            // Chọn giọng phù hợp
            const voices = speechSynthesis.getVoices();
            const voice = voices.find(v => v.lang === currentLang) || voices[0];
            if (voice) {
                currentUtterance.voice = voice;
                webSpeechVoice.textContent = `${voice.name} (${voice.lang})`;
            }
            
            currentUtterance.onstart = function() {
                webSpeechStatus.textContent = 'Đang đọc...';
            };
            
            currentUtterance.onend = function() {
                webSpeechStatus.textContent = 'Hoàn thành';
            };
            
            currentUtterance.onerror = function(event) {
                webSpeechStatus.textContent = 'Lỗi: ' + event.error;
            };
            
            speechSynthesis.speak(currentUtterance);
            webSpeechStatus.textContent = 'Đang bắt đầu...';
        });
        
        // Dừng đọc
        webSpeechStop.addEventListener('click', function() {
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
                webSpeechStatus.textContent = 'Đã dừng';
            }
        });
        
        // Demo đa ngôn ngữ
        webSpeechDemo.addEventListener('click', function() {
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
            
            const demos = [
                { lang: 'vi-VN', text: 'Xin chào, tôi là giọng tiếng Việt' },
                { lang: 'en-US', text: 'Hello, I am English US voice' },
                { lang: 'en-GB', text: 'Hello, I am English UK voice' },
                { lang: 'fr-FR', text: 'Bonjour, je suis la voix française' },
                { lang: 'es-ES', text: 'Hola, soy la voz española' },
                { lang: 'ja-JP', text: 'こんにちは、私は日本語の音声です' }
            ];
            
            let index = 0;
            
            function speakNext() {
                if (index >= demos.length) {
                    webSpeechStatus.textContent = 'Đã hoàn thành demo';
                    return;
                }
                
                const demo = demos[index];
                currentUtterance = new SpeechSynthesisUtterance(demo.text);
                currentUtterance.lang = demo.lang;
                
                // Chọn giọng phù hợp
                const voices = speechSynthesis.getVoices();
                const voice = voices.find(v => v.lang === demo.lang) || voices[0];
                if (voice) {
                    currentUtterance.voice = voice;
                }
                
                currentUtterance.onend = function() {
                    index++;
                    setTimeout(speakNext, 500);
                };
                
                webSpeechStatus.textContent = `Đang đọc: ${demo.lang} - "${demo.text}"`;
                speechSynthesis.speak(currentUtterance);
                index++;
            }
            
            speakNext();
        });
        
        // ========== PHẦN 2: GOOGLE TRANSLATE TTS ==========
        const googleBtn = document.getElementById('googleBtn');
        const googleStop = document.getElementById('googleStop');
        const googleText = document.getElementById('googleText');
        const googleStatus = document.getElementById('googleStatus');
        const googleLangButtons = document.querySelectorAll('#googleLanguages .lang-btn');
        const googleTTSFrame = document.getElementById('googleTTSFrame');
        
        let googleCurrentLang = 'vi';
        let googleAudio = null;
        
        // Thay đổi ngôn ngữ Google TTS
        googleLangButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                googleLangButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                googleCurrentLang = this.getAttribute('data-lang');
                googleStatus.textContent = `Đã chọn ngôn ngữ: ${googleCurrentLang}`;
            });
        });
        
        // Đọc bằng Google TTS
        googleBtn.addEventListener('click', function() {
            const text = googleText.value.trim();
            if (!text) {
                googleStatus.textContent = 'Vui lòng nhập văn bản';
                return;
            }
            
            // Dừng audio đang phát nếu có
            if (googleAudio) {
                googleAudio.pause();
            }
            
            // Tạo URL Google TTS
            const encodedText = encodeURIComponent(text);
            const ttsUrl = `https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&tl=${googleCurrentLang}&q=${encodedText}`;
            
            // Tạo audio element
            googleAudio = new Audio(ttsUrl);
            googleStatus.textContent = 'Đang tải và phát âm thanh...';
            
            googleAudio.play().then(() => {
                googleStatus.textContent = 'Đang phát...';
            }).catch(error => {
                googleStatus.textContent = 'Lỗi khi phát: ' + error.message;
                console.error('Google TTS Error:', error);
            });
            
            googleAudio.onended = function() {
                googleStatus.textContent = 'Hoàn thành';
            };
        });
        
        // Dừng Google TTS
        googleStop.addEventListener('click', function() {
            if (googleAudio) {
                googleAudio.pause();
                googleAudio.currentTime = 0;
                googleStatus.textContent = 'Đã dừng';
            }
        });
        
        // ========== PHẦN 3: HỆ THỐNG VOICES ==========
        const systemBtn = document.getElementById('systemBtn');
        const systemSpeak = document.getElementById('systemSpeak');
        const systemText = document.getElementById('systemText');
        const systemVoices = document.getElementById('systemVoices');
        
        // Hiển thị giọng có sẵn
        systemBtn.addEventListener('click', function() {
            const voices = speechSynthesis.getVoices();
            if (voices.length === 0) {
                systemVoices.textContent = 'Không có voices nào được tìm thấy. Đang tải...';
                // Thử tải lại voices
                speechSynthesis.onvoiceschanged = function() {
                    const loadedVoices = speechSynthesis.getVoices();
                    displayVoices(loadedVoices);
                };
            } else {
                displayVoices(voices);
            }
        });
        
        function displayVoices(voices) {
            const voiceList = voices.map(voice => 
                `${voice.name} (${voice.lang})${voice.default ? ' - Mặc định' : ''}`
            ).join(', ');
            
            systemVoices.textContent = `Tìm thấy ${voices.length} giọng: ${voiceList}`;
        }
        
        // Đọc bằng giọng hệ thống
        systemSpeak.addEventListener('click', function() {
            const text = systemText.value.trim();
            if (!text) {
                alert('Vui lòng nhập văn bản');
                return;
            }
            
            const utterance = new SpeechSynthesisUtterance(text);
            
            // Lấy giọng đầu tiên không phải là giọng mặc định của trình duyệt (nếu có)
            const voices = speechSynthesis.getVoices();
            if (voices.length > 0) {
                // Ưu tiên giọng tiếng Việt, nếu không có thì dùng giọng đầu tiên
                const vietnameseVoice = voices.find(v => v.lang.startsWith('vi'));
                if (vietnameseVoice) {
                    utterance.voice = vietnameseVoice;
                    utterance.lang = 'vi-VN';
                }
            }
            
            speechSynthesis.speak(utterance);
        });
        
        // ========== KHỞI TẠO KHI TRANG ĐƯỢC TẢI ==========
        document.addEventListener('DOMContentLoaded', function() {
            initVoices();
            
            // Tự động tải voices cho hệ thống
            setTimeout(() => {
                const voices = speechSynthesis.getVoices();
                displayVoices(voices);
            }, 1000);
            
            console.log('Demo TTS đã sẵn sàng!');
            console.log('Hỗ trợ Web Speech API:', 'speechSynthesis' in window);
            console.log('Hỗ trợ Speech Recognition:', 'SpeechRecognition' in window || 'webkitSpeechRecognition' in window);
        });
    </script>
</body>
</html>
